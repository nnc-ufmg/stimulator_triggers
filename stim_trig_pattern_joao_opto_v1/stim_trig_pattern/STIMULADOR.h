
#ifndef STIMULADOR_H
#define STIMULADOR_H

/* SERIAL DIGITAL WRITE   
 *  
 */
inline void digital_write_direct(int pin, boolean val){
  if(val) g_APinDescription[pin].pPort -> PIO_SODR = g_APinDescription[pin].ulPin;
  else    g_APinDescription[pin].pPort -> PIO_CODR = g_APinDescription[pin].ulPin;
}
/* SERIAL DIGITAL READ 
 *  
 */
inline int digital_read_direct(int pin){
  return !!(g_APinDescription[pin].pPort -> PIO_PDSR & g_APinDescription[pin].ulPin);
}


/* ALL FUNCTIONS
*/
extern void start_stimulation();
extern void stop_stimulation();
extern void OnOffSwitch();


/*
Setting definitions of variables to be used in the current version of this software
*/
const byte interruptPin = 21;             //This is the ON/OFF switch form the trigger
const byte synchronizationPin = 20;       //This is the pin synchronizing each word.
bool bAnyChannelActive=false;
unsigned long ulTIMEread;

// Settings to trigger the stimulator
unsigned long square_length_positive = 15000;         // in microseconds
unsigned long square_length_negative = 15000;         // in microseconds
unsigned long square_interval = 5;                    // in microseconds

// To test on osciloscope is better to increase the square length
//unsigned long square_length_positive = 1000;        // in microseconds
//unsigned long square_length_negative = 1000;        // in microseconds
//unsigned long square_interval = 5;                  // in microseconds

//DATA PER EACH CHANNEL

// Periodic
#define SizeOfChannel1 1
unsigned long INTERVALS_Channel1 [SizeOfChannel1]={
250
};
unsigned long LastReadChannel1=0;
unsigned long PositionChannel1=0;
bool bStartChannel1=false;
const byte bytePosPinChannel1=2;
const byte byteNegPinChannel1=12;

// Non-Periodic - IH
#define SizeOfChannel2 2400
unsigned long INTERVALS_Channel2 [SizeOfChannel2]={
50,20,20,95,321,469,123,210,642,55,107,148,224,188,278,630,492,29,20,463,88,28,100,551,267,22,102,425,755,87,74,74,564,38,275,740,20,57,44,917,236,37,20,420,353,20,43,858,41,259,21,551,140,134,173,347,105,360,177,877,37,37,31,730,138,79,71,297,121,400,86,1032,20,35,20,487,135,109,210,823,60,49,90,553,238,209,20,107,75,358,296,714,410,20,20,957,20,20,20,263,39,369,322,901,53,31,20,249,214,92,65,482,351,485,20,86,469,155,304,485,189,151,20,608,49,27,300,376,373,111,20,690,95,499,26,679,20,86,44,730,24,207,149,317,206,28,166,515,768,20,25,814,71,34,48,125,257,137,526,350,28,463,175,203,334,375,20,196,398,92,339,428,113,154,283,118,621,307,20,187,446,341,20,769,20,132,26,385,70,448,78,327,669,20,20,63,849,110,20,672,246,20,20,77,419,263,183,751,90,189,20,816,59,52,20,251,67,738,26,259,381,328,20,746,244,20,20,678,175,54,20,355,531,36,25,874,80,20,79,632,120,136,78,727,98,75,179,925,20,27,23,580,133,197,61,342,231,265,73,242,35,631,71,282,749,63,21,146,436,151,302,687,20,95,81,674,392,49,21,704,212,20,20,913,78,20,20,85,608,245,76,184,605,20,70,939,33,35,42,456,226,257,43,190,614,111,39,435,500,95,99,258,20,246,476,679,230,20,28,514,340,115,58,780,166,20,20,823,24,89,20,849,164,20,20,353,358,160,107,399,315,237,73,90,575,243,79,611,260,20,105,812,20,134,40,675,25,173,147,741,154,34,59,346,521,36,69,417,109,263,182,817,59,63,20,795,204,106,20,485,255,199,29,618,344,20,20,663,72,279,20,478,203,95,20,1090,43,51,20,728,84,20,78,867,59,23,95,223,273,117,148,530,47,212,188,722,417,20,77,461,451,82,20,804,20,20,105,825,145,73,51,82,664,22,71,718,84,172,75,326,68,218,445,946,20,20,20,820,20,94,20,381,367,258,75,54,425,216,158,1048,29,20,50,285,39,522,151,693,233,35,23,788,59,89,99,742,155,84,20,39,306,138,277,928,278,21,20,933,20,20,20,821,152,20,20,611,263,56,69,924,37,20,20,395,253,237,20,772,267,20,20,587,142,169,58,424,219,263,20,588,280,235,25,575,100,20,215,404,46,401,152,820,191,57,20,796,106,63,31,383,490,105,20,335,473,111,20,653,152,105,89,180,719,92,82,297,445,20,236,311,481,20,124,141,328,93,479,531,124,272,47,136,467,399,30,76,531,20,345,535,228,232,54,929,20,20,28,915,20,33,20,570,151,50,20,857,286,45,20,299,630,20,39,720,109,174,20,904,20,20,31,161,713,124,23,157,768,58,20,612,51,148,92,855,162,63,20,900,37,20,20,833,81,20,66,746,96,88,75,557,358,20,27,769,20,124,20,647,294,86,20,916,30,109,20,640,240,53,48,544,54,25,175,938,164,20,20,1014,20,20,20,557,81,328,20,480,137,369,20,644,96,246,20,851,108,20,20,28,907,22,20,536,339,96,20,750,39,143,38,540,141,279,49,106,719,56,94,842,20,130,83,864,36,20,74,623,36,128,29,1079,20,20,43,806,34,49,32,519,425,51,68,875,115,30,20,186,363,88,361,500,20,339,20,308,785,20,20,323,518,20,112,219,60,654,20,147,770,20,84,593,291,27,57,665,333,60,25,882,48,42,22,211,191,120,378,695,20,95,88,665,237,52,211,357,20,532,22,511,213,317,20,526,71,389,65,206,92,28,233,1171,109,20,66,216,137,73,498,944,70,63,73,436,290,237,20,904,76,20,20,726,145,97,20,33,844,20,107,631,136,168,46,192,97,20,327,1254,20,82,20,96,27,866,20,732,20,231,20,643,157,43,60,498,453,20,62,274,308,172,56,827,351,20,44,777,173,41,20,23,891,27,20,539,94,247,76,938,75,20,44,44,756,184,20,337,280,51,242,840,117,82,20,798,36,87,56,200,279,400,90,282,446,338,20,169,373,20,207,444,312,129,181,1086,35,24,22,922,20,24,20,553,420,20,20,673,139,145,20,104,414,318,74,447,67,451,78,401,189,260,200,259,227,306,42,919,74,81,22,117,155,486,20,631,390,31,20,971,170,21,75,37,70,85,474,1110,65,107,20,168,20,541,125,521,40,338,38,776,429,20,20,113,547,228,109,357,233,20,229,522,224,24,277,718,52,248,25,452,48,483,54,103,610,227,88,935,20,20,20,347,544,20,20,823,167,48,20,479,322,32,52,886,169,46,20,182,51,478,217,222,654,81,93,63,813,102,20,439,237,296,70,751,21,49,69,673,361,57,20,832,127,20,20,299,125,547,20,204,321,323,126,245,523,101,48,370,504,67,160,733,136,64,44,147,773,60,26,430,77,20,477,261,562,113,20,806,20,112,22,819,68,134,41,554,292,191,20,126,772,49,26,622,56,302,42,26,449,43,329,275,458,106,218,390,655,20,20,331,320,135,100,636,111,114,265,272,190,517,20,176,80,162,298,328,386,518,28,483,409,33,44,763,136,76,20,160,445,243,69,420,298,187,238,439,248,46,219,142,519,292,20,780,174,81,20,86,826,57,20,352,56,569,26,172,246,502,102,313,628,30,26,764,194,37,20,69,20,112,722,627,149,45,256,22,385,20,277,635,465,27,167,328,465,20,78,614,322,126,34,35,404,204,236,708,294,40,74,949,20,30,20,518,285,74,96,60,827,76,20,455,20,167,338,547,54,156,161,552,214,62,299,921,47,22,20,103,115,192,441,736,196,40,96,320,390,323,20,704,199,20,46,235,637,20,113,139,562,325,32,28,697,159,41,140,791,96,45,93,642,20,216,259,566,114,20,297,308,394,32,736,20,195,87,791,41,78,44,251,495,105,196,492,390,70,27,882,71,27,28,286,148,112,404,181,556,309,21,468,108,114,193,986,81,21,20,604,97,208,20,898,141,20,20,597,222,89,59,94,718,140,28,667,125,158,43,340,423,20,238,630,302,35,74,238,524,193,23,176,713,110,24,322,95,455,106,141,83,560,201,384,360,253,35,825,115,25,29,561,118,176,20,243,103,696,59,345,41,413,173,673,96,208,92,488,361,77,47,773,172,20,57,795,166,20,20,838,119,20,20,433,454,20,20,121,52,115,737,563,227,161,101,88,539,259,29,148,405,115,83,472,90,95,53,686,883,20,21,192,586,208,28,289,420,20,118,1089,20,20,20,439,361,106,20,146,826,88,22,785,166,20,20,449,102,87,66,894,163,48,60,214,670,38,201,47,562,52,236,153,492,301,77,494,388,164,34,276,498,55,159,366,219,409,20,753,193,48,22,802,80,51,27,591,369,57,20,332,433,97,87,200,736,26,20,871,157,20,20,473,352,138,34,604,20,44,334,842,20,119,20,810,57,23,52,831,20,28,177,720,20,118,20,914,125,20,29,400,339,86,130,716,136,115,26,203,770,89,20,861,20,85,23,163,466,360,32,399,64,235,70,543,373,73,241,209,69,491,40,446,250,235,251,139,615,60,20,489,359,147,113,761,132,141,20,262,191,483,46,517,410,74,20,536,158,72,140,126,100,700,77,493,489,20,28,618,84,315,20,752,43,96,90,191,205,554,77,546,122,133,222,771,29,163,20,529,221,148,20,379,426,226,62,411,213,145,43,307,94,708,46,558,22,23,20,843,23,466,25,340,32,631,40,891,67,20,25,432,163,134,171,228,771,92,20,496,333,126,44,257,640,60,24,476,397,49,63,365,380,144,93,298,204,501,20,860,21,24,117,83,120,31,301,1328,31,20,23,626,197,100,72,911,65,73,28,451,349,152,45,936,20,20,20,821,23,47,74,733,235,20,37,451,217,228,121,723,216,24,20,578,41,117,236,200,43,656,60,558,284,122,81,634,238,103,20,184,748,51,49,895,60,20,20,840,35,36,76,197,668,88,58,688,61,94,54,804,103,62,25,352,96,590,20,728,290,20,22,491,121,295,63,122,350,411,63,730,42,56,126,885,65,49,84,143,353,347,135,569,233,20,131,380,22,45,560,994,31,62,25,475,142,161,219,137,602,62,72,1053,31,35,20,61,819,20,68,518,42,370,56,817,185,20,20,35,73,540,154,893,117,94,45,965,46,20,23,366,99,423,62,593,36,131,71,1030,127,37,20,613,27,207,111,765,182,33,20,69,924,24,20,342,622,20,20,184,73,232,138,744,400,130,20,517,391,141,20,360,50,556,44,486,134,308,72,253,155,150,405,643,92,58,35,544,376,31,255,645,245,44,69,857,20,69,20,231,301,20,20,956,293,79,69,510,52,146,243,568,27,20,502,428,31,418,66,84,535,145,200,886,22,90,93,437,340,197,20,555,69,38,261,267,198,176,382,978,20,27,20,574,40,43,268,743,257,22,31,278,634,28,69,123,358,461,50,281,526,118,41,164,28,236,139,1260,37,104,90,600,169,20,162,288,96,244,91,1184,120,20,20,324,395,202,20,857,154,31,20,101,702,166,24,302,134,243,115,833,200,23,133,857,111,20,20,144,96,184,198,498,72,379,256,1119,20,20,20,105,436,67,163,589,580,22,20,565,63,277,89,51,670,20,191,848,103,20,124,672,210,75,20,886,86,34,20,693,242,34,20,806,22,109,33,782,160,20,55,234,300,157,329,61,287,284,250,631,361,24,20,910,81,75,20,761,85,27,34,631,417,20,20,138,316,166,215,566,542,20,24,610,58,254,37,79,306,429,52,882,122,165,20,558,314,78,31,628,188,134,60,828,67,24,20,990,30,20,24,201,166,120,279,759,407,46,20,345,414,131,88,198,178,365,176,215,152,154,309,1030,190,20,33,177,287,118,175,650,416,108,23,267,154,584,20,676,295,21,20,340,270,354,34,619,199,78,57,421,505,23,20,613,421,26,27,290,117,93,344,634,87,199,54,1053,49,63,20,543,274,48,28,245,289,248,180,372,716,36,20,532,20,99,350,460,122,158,258,64,362,179,155,318,731,20,163,787,123,64,20,810,73,61,20,117,277,123,310,1096,43,37,20,921,52,20,20,574,35,20,169,492,663,20,20,935,20,47,20,200,351,29,96,1162,20,24,36,680,63,20,20,915,20,156,152,663,40,284,20,285,97,581,20,910,82,20,40,839,129,20,20,617,20,194,20,619,72,304,109,123,433,412,23,936,44,26,29,473,322,193,20,789,113,82,28,614,295,61,20,782,23,174,20,628,245,79,20,242,96,230,173,1149,91,20,20,880,97,24,20,873,68,35,29,765,99,113,26,235,473,20,20,805,314,29,20,810,81,32,137,885,30,45,26,364,175,466,29,698,169,78,21,540,412,46,24,351,368,235,32,452,448,44,22,455,426,20,154,174,238,535,22
};
unsigned long LastReadChannel2=0;
unsigned long PositionChannel2=0;
bool bStartChannel2=false;
const byte bytePosPinChannel2=3;
const byte byteNegPinChannel2=13;

// Unorganized pattern (different words)
// #define SizeOfChannel3 840
// unsigned long INTERVALS_Channel3 [SizeOfChannel3]={925,30,30,15,865,15,15,15,955,15,45,15,925,30,30,45,925,30,45,30,865,45,15,60,880,75,30,15,925,15,60,15,865,30,60,30,955,15,15,30,865,90,30,15,880,15,45,30,910,15,15,30,955,15,75,15,880,45,15,45,910,30,15,45,895,45,30,45,925,15,30,15,895,75,30,15,865,45,45,30,910,45,45,15,865,75,30,30,865,15,60,30,910,75,15,15,910,15,30,15,940,60,15,15,880,15,15,60,955,45,15,30,865,45,15,30,910,45,75,15,895,60,30,15,895,15,30,45,910,15,15,75,880,45,15,15,910,15,30,60,955,15,45,15,865,15,45,45,895,45,60,30,880,30,15,45,955,15,30,30,910,30,15,15,910,15,30,15,955,45,30,30,865,45,30,15,940,15,45,45,880,45,15,60,895,15,30,30,910,30,30,60,880,60,45,15,865,90,15,30,910,45,30,15,880,15,90,15,940,30,15,15,865,60,30,45,895,15,15,60,880,60,45,30,865,15,45,75,880,30,15,15,970,15,30,30,880,45,15,75,865,30,60,15,895,30,15,15,985,30,30,15,880,15,60,45,955,15,15,15,895,30,45,15,895,30,45,30,895,30,90,15,865,45,30,45,895,30,30,30,895,75,15,30,880,60,30,30,940,30,15,30,880,15,30,75,880,30,15,75,895,15,15,30,925,15,30,60,880,15,30,75,925,15,30,45,895,30,15,15,910,90,15,15,925,60,15,15,865,30,15,60,910,30,60,30,865,30,45,45,970,15,15,15,895,15,30,60,910,30,30,30,895,30,60,15,865,30,15,45,970,45,15,15,910,45,15,15,880,30,15,30,925,15,75,30,895,15,15,15,955,45,45,30,880,15,60,45,865,60,15,30,895,15,105,15,880,30,15,30,940,15,60,15,925,15,45,15,895,30,15,60,895,60,15,30,895,60,30,15,910,30,45,15,925,30,45,15,865,15,15,90,895,15,30,30,910,30,45,15,925,45,30,30,895,15,75,15,880,75,45,15,880,45,15,30,895,30,15,90,880,15,15,60,925,75,15,15,865,15,30,90,895,45,30,15,910,15,60,30,865,15,15,45,925,15,90,30,895,30,30,45,895,60,15,30,865,30,15,75,880,15,60,15,925,15,45,15,910,45,45,15,910,60,30,30,880,30,75,15,865,60,15,45,910,45,15,45,880,45,45,15,880,15,30,45,970,15,15,30,880,15,60,60,895,30,15,60,865,30,60,45,880,15,45,45,880,60,30,15,910,90,15,15,880,30,30,45,895,60,15,45,895,15,15,45,910,15,15,45,940,15,45,30,880,15,45,60,895,30,60,15,910,45,15,30,895,30,45,30,880,75,15,15,940,30,15,30,895,60,15,15,895,30,30,60,880,15,30,15,940,60,15,60,865,45,15,15,925,15,15,75,895,60,60,15,880,15,75,30,925,30,15,15,880,15,75,15,895,30,30,30,940,30,30,30,880,45,60,15,895,15,15,75,895,30,30,15,910,105,15,15,865,45,30,30,895,30,75,30,865,15,15,30,985,15,45,30,880,15,30,45,940,30,15,45,910,15,30,15,940,15,15,45,880,15,90,15,880,15,45,30,910,15,15,105,865,30,75,15,955,15,30,15,910,15,15,30,895,60,45,15,880,75,15,45,925,15,15,15,895,45,15,45,895,15,30,30,940,30,45,45,865,30,45,60,865,45,45,45,895,15,45,15,910,15,60,30,895,45,30,15,925,15,15,15,955,30,30,15,910,15,15,90,925,15,15,45,865,30,30,15,940,75,15,30,895,45,15,15,895,30,30,75,895,30,15,30,910,15,60,15,895,45,30,60,865,60,15,15,955,15,15,15,925,45,60,15,880,15,45,60,865,15,75,45,910,15,15,60};

#define SizeOfChannel3 1
unsigned long INTERVALS_Channel3 [SizeOfChannel3]={
30
};
unsigned long LastReadChannel3=0;
unsigned long PositionChannel3=0;
bool bStartChannel3=false;
const byte bytePosPinChannel3=4;
const byte byteNegPinChannel3=14;

// Organized pattern (same word)
#define SizeOfChannel4 4
unsigned long INTERVALS_Channel4 [SizeOfChannel4]={
865,60,30,45
};  //553	1000101001
unsigned long LastReadChannel4=0;
unsigned long PositionChannel4=0;
bool bStartChannel4=false;
const byte bytePosPinChannel4=5;
const byte byteNegPinChannel4=15;

// Test (periodic stimuli ate 30ms)
#define SizeOfChannel5 1
unsigned long INTERVALS_Channel5 [SizeOfChannel5]={
50
};
unsigned long LastReadChannel5=0;
unsigned long PositionChannel5=0;
bool bStartChannel5=false;
const byte bytePosPinChannel5=6;
const byte byteNegPinChannel5=16;

#define NumberOfChannels 8
static byte chpinP[NumberOfChannels] = {
  2,3,4,5,6,7,8,9
  };
static byte chpinN[NumberOfChannels] = {
  12,13,14,15,16,17,18,19
  };
#endif
